<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­˜æ¡£ç³»ç»Ÿæµ‹è¯• - Pet Plan</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/save-system.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .test-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        .status-display {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .status-label {
            font-weight: bold;
            color: #667eea;
        }
        
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
            font-weight: bold;
        }
        
        .info {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ® å­˜æ¡£ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š å½“å‰æ¸¸æˆçŠ¶æ€</h2>
            <div class="status-display" id="gameStatus">
                <div><span class="status-label">ç©å®¶ç­‰çº§:</span> <span id="playerLevel">1</span></div>
                <div><span class="status-label">ç”Ÿå‘½å€¼:</span> <span id="playerHp">100</span></div>
                <div><span class="status-label">æ”»å‡»åŠ›:</span> <span id="playerAttack">20</span></div>
                <div><span class="status-label">é‡‘å¸:</span> <span id="coins">1000</span></div>
                <div><span class="status-label">çº¢å®çŸ³:</span> <span id="rubies">50</span></div>
                <div><span class="status-label">æ°´æ™¶:</span> <span id="crystals">0</span></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ² æ¨¡æ‹Ÿæ¸¸æˆæ“ä½œ</h2>
            <div class="test-buttons">
                <button class="test-btn" onclick="increaseLevel()">å‡çº§</button>
                <button class="test-btn" onclick="addCoins()">+1000 é‡‘å¸</button>
                <button class="test-btn" onclick="addRubies()">+50 çº¢å®çŸ³</button>
                <button class="test-btn" onclick="addCrystals()">+10 æ°´æ™¶</button>
                <button class="test-btn" onclick="upgradeAttack()">å‡çº§æ”»å‡»</button>
                <button class="test-btn" onclick="resetData()">é‡ç½®æ•°æ®</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’¾ å­˜æ¡£æ“ä½œ</h2>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSave(1)">ä¿å­˜åˆ°æ§½ä½1</button>
                <button class="test-btn" onclick="testSave(2)">ä¿å­˜åˆ°æ§½ä½2</button>
                <button class="test-btn" onclick="testLoad(1)">åŠ è½½æ§½ä½1</button>
                <button class="test-btn" onclick="testLoad(2)">åŠ è½½æ§½ä½2</button>
                <button class="test-btn" onclick="showAllSaves()">æŸ¥çœ‹æ‰€æœ‰å­˜æ¡£</button>
                <button class="test-btn" onclick="openSaveUI()">æ‰“å¼€å­˜æ¡£ç•Œé¢</button>
            </div>
            <div class="status-display" id="saveStatus">
                <span class="info">ç­‰å¾…æ“ä½œ...</span>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
            <div class="status-display" id="logDisplay" style="max-height: 200px; overflow-y: auto;">
                <div class="info">ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ª</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { getSaveSystemInstance } from './js/modules/save-system.js';
        import ResourceSystem from './js/modules/resource-system.js';
        import SaveUI from './js/modules/save-ui.js';

        // æ¨¡æ‹Ÿæ¸¸æˆæ•°æ®
        let gameData = {
            player: {
                level: 1,
                hp: 100,
                maxHp: 100,
                attack: 20
            }
        };

        // åˆå§‹åŒ–ç³»ç»Ÿ
        const resourceSystem = ResourceSystem.getInstance();
        const saveSystem = getSaveSystemInstance();
        
        // æ¨¡æ‹Ÿç³»ç»Ÿå¼•ç”¨
        const mockPlayerSystem = {
            getSaveData: () => ({ player: gameData.player }),
            loadSaveData: (data) => {
                if (data && data.player) {
                    gameData.player = { ...data.player };
                    updateDisplay();
                    addLog('ç©å®¶æ•°æ®å·²åŠ è½½', 'success');
                }
            }
        };

        const mockTerritorySystem = {
            getSaveData: () => ({ level: 1, buildings: [] }),
            loadSaveData: () => {}
        };

        const mockCombatSystem = {
            getSaveData: () => ({}),
            loadSaveData: () => {}
        };

        saveSystem.setSystems(mockPlayerSystem, mockTerritorySystem, resourceSystem, mockCombatSystem);

        // åˆå§‹åŒ–å­˜æ¡£UI
        const saveUI = new SaveUI(saveSystem);

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('playerLevel').textContent = gameData.player.level;
            document.getElementById('playerHp').textContent = gameData.player.hp;
            document.getElementById('playerAttack').textContent = gameData.player.attack;
            document.getElementById('coins').textContent = resourceSystem.getCoins();
            document.getElementById('rubies').textContent = resourceSystem.getRubies();
            document.getElementById('crystals').textContent = resourceSystem.getCrystals();
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logDisplay = document.getElementById('logDisplay');
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDisplay.insertBefore(logEntry, logDisplay.firstChild);
            
            // é™åˆ¶æ—¥å¿—æ¡æ•°
            if (logDisplay.children.length > 50) {
                logDisplay.removeChild(logDisplay.lastChild);
            }
        }

        // æ¸¸æˆæ“ä½œå‡½æ•°
        window.increaseLevel = () => {
            gameData.player.level++;
            gameData.player.maxHp += 20;
            gameData.player.hp = gameData.player.maxHp;
            updateDisplay();
            addLog(`å‡çº§åˆ° Lv.${gameData.player.level}`, 'success');
        };

        window.addCoins = () => {
            resourceSystem.addCoins(1000);
            updateDisplay();
            addLog('è·å¾— 1000 é‡‘å¸', 'success');
        };

        window.addRubies = () => {
            resourceSystem.addRubies(50);
            updateDisplay();
            addLog('è·å¾— 50 çº¢å®çŸ³', 'success');
        };

        window.addCrystals = () => {
            resourceSystem.addCrystals(10);
            updateDisplay();
            addLog('è·å¾— 10 æ°´æ™¶', 'success');
        };

        window.upgradeAttack = () => {
            gameData.player.attack += 5;
            updateDisplay();
            addLog(`æ”»å‡»åŠ›æå‡åˆ° ${gameData.player.attack}`, 'success');
        };

        window.resetData = () => {
            gameData.player = {
                level: 1,
                hp: 100,
                maxHp: 100,
                attack: 20
            };
            resourceSystem.setCoins(1000);
            resourceSystem.setRubies(50);
            resourceSystem.setCrystals(0);
            updateDisplay();
            addLog('æ•°æ®å·²é‡ç½®', 'info');
        };

        // å­˜æ¡£æ“ä½œå‡½æ•°
        window.testSave = (slot) => {
            const success = saveSystem.saveGame(slot);
            const statusDiv = document.getElementById('saveStatus');
            if (success) {
                statusDiv.innerHTML = `<span class="success">âœ“ å·²ä¿å­˜åˆ°æ§½ä½ ${slot}</span>`;
                addLog(`æ¸¸æˆå·²ä¿å­˜åˆ°æ§½ä½ ${slot}`, 'success');
            } else {
                statusDiv.innerHTML = `<span class="error">âœ— ä¿å­˜å¤±è´¥</span>`;
                addLog(`ä¿å­˜åˆ°æ§½ä½ ${slot} å¤±è´¥`, 'error');
            }
        };

        window.testLoad = (slot) => {
            const success = saveSystem.loadGame(slot);
            const statusDiv = document.getElementById('saveStatus');
            if (success) {
                statusDiv.innerHTML = `<span class="success">âœ“ å·²ä»æ§½ä½ ${slot} åŠ è½½</span>`;
                addLog(`å·²ä»æ§½ä½ ${slot} åŠ è½½æ¸¸æˆ`, 'success');
            } else {
                statusDiv.innerHTML = `<span class="error">âœ— åŠ è½½å¤±è´¥ï¼ˆå¯èƒ½æ§½ä½ä¸ºç©ºï¼‰</span>`;
                addLog(`ä»æ§½ä½ ${slot} åŠ è½½å¤±è´¥`, 'error');
            }
        };

        window.showAllSaves = () => {
            const saves = saveSystem.getAllSaves();
            const statusDiv = document.getElementById('saveStatus');
            let html = '<div><strong>æ‰€æœ‰å­˜æ¡£:</strong></div>';
            saves.forEach(save => {
                if (save.exists) {
                    html += `<div class="success">æ§½ä½ ${save.slot}: ${save.slotInfo.savedAt} (Lv.${save.slotInfo.playerLevel})</div>`;
                } else {
                    html += `<div class="info">æ§½ä½ ${save.slot}: ç©º</div>`;
                }
            });
            statusDiv.innerHTML = html;
            addLog('æŸ¥çœ‹æ‰€æœ‰å­˜æ¡£ä¿¡æ¯', 'info');
        };

        window.openSaveUI = () => {
            addLog('æ‰“å¼€å­˜æ¡£ç®¡ç†ç•Œé¢', 'info');
            // SaveUI ä¼šè‡ªåŠ¨å¤„ç†
        };

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateDisplay();
        addLog('æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'success');
        addLog('å¯ä»¥å¼€å§‹æµ‹è¯•å­˜æ¡£ç³»ç»ŸåŠŸèƒ½', 'info');
    </script>
</body>
</html>
