# 图片资源说明

## 概述

宠物计划项目使用多种图片资源来构建游戏界面和角色形象。本文档详细说明了项目中使用的图片资源及其用途。

## 资源目录结构

```
images/
├── cw/                    # 角色图片目录
│   ├── 001-.png          # 角色图片 1
│   ├── 004-.png          # 角色图片 2
│   ├── 007-.png          # 角色图片 3
│   ├── 010-.png          # 角色图片 4
│   ├── 013-.png          # 角色图片 5
│   └── 016-.png          # 角色图片 6
└── rw/                    # 其他图片目录
    └── rw3.png           # 主要角色图片
```

## 图片资源详情

### 角色图片 (cw/)

#### 001-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

#### 004-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

#### 007-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

#### 010-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

#### 013-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

#### 016-.png
- **用途**: 角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 角色选择界面

### 主要角色图片 (rw/)

#### rw3.png
- **用途**: 主要角色形象
- **尺寸**: 待确认
- **格式**: PNG
- **透明度**: 支持
- **使用场景**: 
  - 游戏主界面角色显示
  - 角色管理界面
  - 顶部状态栏头像

## 图片使用方式

### 1. HTML 中使用

```html
<!-- 角色头像 -->
<img src="./images/rw/rw3.png" 
     alt="rw3" 
     style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%;">

<!-- 角色管理界面 -->
<img src="./images/rw/rw3.png" 
     alt="rw3" 
     class="character-avatar-img">
```

### 2. JavaScript 中使用

```javascript
// 加载角色图片
this.playerImage = new Image();
this.playerImage.src = './images/rw/rw3.png';
this.playerImageLoaded = false;

this.playerImage.onload = () => {
    this.playerImageLoaded = true;
    console.log('角色图片加载成功');
};

this.playerImage.onerror = () => {
    console.error('角色图片加载失败:', this.playerImage.src);
    this.playerImageLoaded = false;
};
```

### 3. CSS 中使用

```css
/* 角色头像样式 */
.player-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
}

.character-avatar-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}
```

## 图片加载管理

### 1. 预加载机制

```javascript
// 图片预加载函数
function preloadImages(urls) {
    const promises = urls.map(url => {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = resolve;
            img.onerror = reject;
            img.src = url;
        });
    });
    
    return Promise.all(promises);
}

// 预加载所有角色图片
const characterImages = [
    './images/cw/001-.png',
    './images/cw/004-.png',
    './images/cw/007-.png',
    './images/cw/010-.png',
    './images/cw/013-.png',
    './images/cw/016-.png'
];

preloadImages(characterImages)
    .then(() => {
        console.log('所有角色图片加载完成');
    })
    .catch(error => {
        console.error('图片加载失败:', error);
    });
```

### 2. 加载状态管理

```javascript
// 图片加载状态管理
class ImageManager {
    constructor() {
        this.images = new Map();
        this.loadingPromises = new Map();
    }
    
    loadImage(src) {
        if (this.images.has(src)) {
            return Promise.resolve(this.images.get(src));
        }
        
        if (this.loadingPromises.has(src)) {
            return this.loadingPromises.get(src);
        }
        
        const promise = new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => {
                this.images.set(src, img);
                this.loadingPromises.delete(src);
                resolve(img);
            };
            img.onerror = () => {
                this.loadingPromises.delete(src);
                reject(new Error(`Failed to load image: ${src}`));
            };
            img.src = src;
        });
        
        this.loadingPromises.set(src, promise);
        return promise;
    }
    
    getImage(src) {
        return this.images.get(src);
    }
    
    isLoaded(src) {
        return this.images.has(src);
    }
}
```

### 3. 错误处理

```javascript
// 图片加载错误处理
function handleImageError(img, fallbackSrc) {
    img.onerror = () => {
        console.warn(`图片加载失败: ${img.src}`);
        if (fallbackSrc) {
            img.src = fallbackSrc;
        } else {
            // 显示占位符
            img.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.textContent = '图片加载失败';
            img.parentNode.insertBefore(placeholder, img);
        }
    };
}
```

## 图片优化建议

### 1. 格式选择

```javascript
// 根据用途选择合适格式
const imageFormats = {
    // PNG格式: 支持透明度，适合图标和角色
    character: 'png',
    
    // JPEG格式: 压缩率高，适合背景图
    background: 'jpg',
    
    // WebP格式: 现代格式，压缩率更高
    modern: 'webp'
};
```

### 2. 尺寸优化

```css
/* 响应式图片 */
.character-image {
    width: 100%;
    height: auto;
    max-width: 200px;
}

/* 不同屏幕尺寸的图片 */
@media (max-width: 768px) {
    .character-image {
        max-width: 150px;
    }
}

@media (min-width: 1024px) {
    .character-image {
        max-width: 250px;
    }
}
```

### 3. 懒加载

```javascript
// 图片懒加载
function lazyLoadImages() {
    const images = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                observer.unobserve(img);
            }
        });
    });
    
    images.forEach(img => imageObserver.observe(img));
}
```

## 图片资源扩展

### 1. 添加新角色图片

```javascript
// 添加新角色图片的步骤
// 1. 将图片文件放入 images/cw/ 目录
// 2. 更新图片列表
const newCharacterImages = [
    './images/cw/001-.png',
    './images/cw/004-.png',
    './images/cw/007-.png',
    './images/cw/010-.png',
    './images/cw/013-.png',
    './images/cw/016-.png',
    './images/cw/019-.png' // 新添加的图片
];

// 3. 更新角色选择逻辑
function selectCharacter(imageSrc) {
    // 更新角色图片
    game.playerImage.src = imageSrc;
    // 保存选择
    localStorage.setItem('selectedCharacter', imageSrc);
}
```

### 2. 动态图片加载

```javascript
// 动态加载图片
async function loadCharacterImage(characterId) {
    try {
        const imageSrc = `./images/cw/${characterId}.png`;
        const img = await imageManager.loadImage(imageSrc);
        return img;
    } catch (error) {
        console.error(`加载角色图片失败: ${characterId}`, error);
        // 返回默认图片
        return imageManager.getImage('./images/rw/rw3.png');
    }
}
```

### 3. 图片缓存管理

```javascript
// 图片缓存管理
class ImageCache {
    constructor(maxSize = 50) {
        this.cache = new Map();
        this.maxSize = maxSize;
    }
    
    set(key, image) {
        if (this.cache.size >= this.maxSize) {
            const firstKey = this.cache.keys().next().value;
            this.cache.delete(firstKey);
        }
        this.cache.set(key, image);
    }
    
    get(key) {
        if (this.cache.has(key)) {
            const image = this.cache.get(key);
            // 移动到末尾（LRU）
            this.cache.delete(key);
            this.cache.set(key, image);
            return image;
        }
        return null;
    }
    
    clear() {
        this.cache.clear();
    }
}
```

## 性能优化

### 1. 图片压缩

```javascript
// 图片压缩
function compressImage(file, quality = 0.8) {
    return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            canvas.toBlob(resolve, 'image/jpeg', quality);
        };
        
        img.src = URL.createObjectURL(file);
    });
}
```

### 2. 图片预加载

```javascript
// 智能预加载
class SmartPreloader {
    constructor() {
        this.priority = ['main', 'character', 'ui'];
        this.loaded = new Set();
    }
    
    async preloadByPriority(images) {
        for (const category of this.priority) {
            const categoryImages = images[category] || [];
            await Promise.all(categoryImages.map(src => this.loadImage(src)));
        }
    }
    
    async loadImage(src) {
        if (this.loaded.has(src)) return;
        
        try {
            await imageManager.loadImage(src);
            this.loaded.add(src);
        } catch (error) {
            console.warn(`预加载失败: ${src}`, error);
        }
    }
}
```

## 最佳实践

### 1. 图片命名规范

```javascript
// 图片命名规范
const namingConvention = {
    // 角色图片: character_[id]_[variant].png
    character: 'character_001_default.png',
    
    // 用户界面图片: ui_[component]_[state].png
    ui: 'ui_button_normal.png',
    
    // 背景图片: bg_[scene]_[time].png
    background: 'bg_forest_day.png'
};
```

### 2. 图片尺寸规范

```javascript
// 图片尺寸规范
const imageSizes = {
    // 角色图片
    character: {
        small: '64x64',
        medium: '128x128',
        large: '256x256'
    },
    
    // 用户界面图标
    icon: {
        small: '16x16',
        medium: '32x32',
        large: '64x64'
    },
    
    // 背景图片
    background: {
        mobile: '375x667',
        tablet: '768x1024',
        desktop: '1920x1080'
    }
};
```

### 3. 图片质量保证

```javascript
// 图片质量检查
function validateImage(img) {
    const checks = {
        hasValidSize: img.width > 0 && img.height > 0,
        hasValidFormat: img.src.match(/\.(png|jpg|jpeg|webp)$/i),
        isNotTooLarge: img.width <= 2048 && img.height <= 2048,
        hasReasonableAspectRatio: img.width / img.height > 0.5 && img.width / img.height < 2
    };
    
    const isValid = Object.values(checks).every(check => check);
    
    if (!isValid) {
        console.warn('图片质量检查失败:', checks);
    }
    
    return isValid;
}
```
