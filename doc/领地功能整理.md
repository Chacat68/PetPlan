# 领地系统功能整理

## 📋 系统概述

领地系统是Pet Plan游戏的核心功能之一，允许玩家建造和管理各种建筑来提升角色属性和获得资源。

## 🏗️ 当前实现的功能

### 1. 领地布局
- **网格系统**: 初始 2x3 网格布局，共6个地块（可扩张至12个）
- **地块状态**: 锁定、解锁、建造中、已建造
- **解锁条件**: 基于玩家等级逐步解锁

### 2. 地块解锁规则

#### 初始地块（6个）
| 地块 | 解锁等级 | 状态 | 说明 |
|------|----------|------|------|
| 地块0 | 等级0 | ✅ 默认开放 | 无任何限制条件 |
| 地块1 | 等级5 | 🔒 锁定 | 需要达到5级 |
| 地块2 | 等级10 | 🔒 锁定 | 需要达到10级 |
| 地块3 | 等级15 | 🔒 锁定 | 需要达到15级 |
| 地块4 | 等级20 | 🔒 锁定 | 需要达到20级 |
| 地块5 | 等级25 | 🔒 锁定 | 需要达到25级 |

#### 扩张地块（通过领地扩张获得）
| 扩张次数 | 新增地块 | 解锁等级要求 |
|----------|----------|--------------|
| 第1次 | 地块6、地块7 | 0级、5级 |
| 第2次 | 地块8、地块9 | 10级、15级 |
| 第3次 | 地块10、地块11 | 20级、25级 |

### 3. 🆕 领地扩张系统

#### 3.1 扩张概述
- **初始地块**: 6个
- **最大地块**: 12个
- **扩张次数**: 最多3次
- **每次扩张**: 增加2个新地块

#### 3.2 扩张成本
| 扩张次数 | 金币消耗 | 水晶消耗 | 主基地等级要求 |
|----------|----------|----------|----------------|
| 第1次 | 10,000 | 500 | 1级 |
| 第2次 | 25,000 | 1,500 | 1级 |
| 第3次 | 50,000 | 3,000 | 2级 |

#### 3.3 扩张功能
- **扩张按钮**: 位于领地界面头部资源栏
- **扩张预览**: 显示即将获得的新地块信息
- **成本检查**: 自动检查资源是否充足
- **进度显示**: 显示当前地块数/最大地块数
- **动态渲染**: 扩张后自动渲染新地块

### 3. 建筑类型

#### 3.1 主基地 (main_base)
- **图标**: 🏰
- **功能**: 控制建筑数量上限
- **等级1**: 生命值1000，建筑上限5个
- **等级2**: 生命值1500，建筑上限8个，升级成本10000金币+500宝石

#### 3.2 训练场 (training_ground)
- **图标**: 🏋️
- **功能**: 提供攻击力加成
- **等级1**: 攻击+5，成本1000金币+0宝石
- **等级2**: 攻击+10，升级成本5000金币+500宝石
- **等级3**: 攻击+20，升级成本15000金币+1500宝石

#### 3.3 神庙 (temple)
- **图标**: 🏛️
- **功能**: 提供防御力加成
- **等级1**: 防御+5，成本1000金币+0宝石
- **等级2**: 防御+10，升级成本5000金币+500宝石
- **等级3**: 防御+20，升级成本15000金币+1500宝石

#### 3.4 兵营 (barracks)
- **图标**: ⚔️
- **功能**: 提供攻防加成
- **等级1**: 生命800，攻防+3，成本2000金币+200宝石
- **等级2**: 生命1200，攻防+6，升级成本8000金币+800宝石
- **等级3**: 生命1800，攻防+12，升级成本20000金币+2000宝石

#### 3.5 工坊 (workshop)
- **图标**: 🔨
- **功能**: 产出金币
- **等级1**: 金币产出50，成本3000金币+300宝石
- **等级2**: 金币产出100，升级成本12000金币+1200宝石
- **等级3**: 金币产出200，升级成本30000金币+3000宝石

#### 3.6 水晶矿 (crystal_mine)
- **图标**: 💎
- **功能**: 产出水晶
- **等级1**: 水晶产出10，成本5000金币
- **等级2**: 水晶产出25，升级成本20000金币+2000宝石
- **等级3**: 水晶产出50，升级成本50000金币+5000宝石

#### 3.7 图书馆 (library)
- **图标**: 📚
- **功能**: 提供经验加成
- **等级1**: 经验+10%，成本4000金币+400宝石
- **等级2**: 经验+25%，升级成本16000金币+1600宝石
- **等级3**: 经验+50%，升级成本40000金币+4000宝石

#### 3.8 医院 (hospital)
- **图标**: 🏥
- **功能**: 提供治疗加成
- **等级1**: 生命1200，治疗+5，成本6000金币+600宝石
- **等级2**: 生命2000，治疗+10，升级成本24000金币+2400宝石
- **等级3**: 生命3000，治疗+20，升级成本60000金币+6000宝石

#### 3.9 防御塔 (tower)
- **图标**: 🗼
- **功能**: 提供大量攻防加成
- **等级1**: 攻防+8，成本8000金币+800宝石
- **等级2**: 攻防+16，升级成本32000金币+3200宝石
- **等级3**: 攻防+32，升级成本80000金币+8000宝石

#### 3.10 市场 (market)
- **图标**: 🏪
- **功能**: 产出金币和水晶
- **等级1**: 金币+100，水晶+5，成本10000金币+1000宝石
- **等级2**: 金币+200，水晶+15，升级成本40000金币+4000宝石
- **等级3**: 金币+400，水晶+30，升级成本100000金币+10000宝石
#### 4.1 建造步骤
1. **点击解锁地块** → 打开建筑选择弹窗
2. **选择建筑类型** → 显示建筑信息和成本
3. **确认建造** → 扣除资源，开始建造
4. **建造进度** → 5秒建造时间，显示进度条
5. **建造完成** → 建筑生效，提供属性加成

#### 4.2 建造限制
- **资源检查**: 必须有足够的金币和宝石
- **建筑上限**: 受主基地等级限制
- **位置限制**: 每个地块只能建造一个建筑

### 5. 建筑管理

#### 5.1 建筑信息查看
- **点击已建造建筑** → 打开建筑信息弹窗
- **显示内容**: 建筑图标、等级、属性加成
- **操作按钮**: 升级、拆迁

#### 5.2 建筑升级
- **升级条件**: 有下一等级数据且资源充足
- **升级效果**: 提升属性加成数值
- **升级成本**: 按等级递增

#### 5.3 建筑拆迁
- **拆迁确认**: 弹出确认对话框
- **拆迁效果**: 移除建筑，地块恢复为解锁状态
- **资源返还**: 目前不返还资源

### 6. 属性加成系统

#### 6.1 属性计算
- **攻击加成**: 所有训练场攻击加成之和
- **防御加成**: 所有神庙防御加成之和
- **总加成**: 通过 `getTotalAttributeBonuses()` 方法计算

#### 6.2 属性应用
- 属性加成直接影响角色战斗能力
- 与战斗系统集成，提升战斗效果

### 7. 用户界面

#### 7.1 领地界面
- **头部**: 显示"领地"标题
- **网格**: 2x3地块布局
- **状态指示**: 不同颜色表示不同状态
  - 🔒 灰色：锁定状态
  - ✅ 绿色：解锁状态
  - 🟠 橙色：建造中状态
  - 🟣 紫色：已建造状态

#### 7.2 弹窗系统
- **建筑选择弹窗**: 显示可建造建筑列表
- **建筑信息弹窗**: 显示建筑详细信息和操作
- **响应式设计**: 支持移动端和桌面端

#### 7.3 交互反馈
- **悬停效果**: 地块悬停时上浮和阴影
- **点击反馈**: 按钮点击动画
- **进度显示**: 建造进度条动画

### 8. 技术实现

#### 8.1 核心模块
- **TerritorySystem**: 领地数据管理和业务逻辑
- **TerritoryScene**: 用户界面和交互控制
- **ResourceSystem**: 资源管理和消耗

#### 8.2 数据存储
- **领地数据**: 建筑列表、位置、等级
- **建筑配置**: 静态数据，包含各等级属性
- **资源数据**: 金币、宝石数量

#### 8.3 事件系统
- **地块点击**: 根据状态执行不同操作
- **弹窗控制**: 打开/关闭各种弹窗
- **建造流程**: 异步建造进度更新

## 🎯 当前状态

### ✅ 已完成功能
- [x] 基础领地布局和地块系统
- [x] 第一块领地默认开放
- [x] 建筑类型定义和配置
- [x] 建造流程和进度显示
- [x] 建筑信息查看和管理
- [x] 属性加成计算系统
- [x] 用户界面和交互设计
- [x] 资源消耗和检查
- [x] **领地扩张系统** 🆕
  - [x] 扩张数据结构
  - [x] 扩张成本配置
  - [x] 扩张UI弹窗
  - [x] 动态地块渲染
  - [x] 扩张进度显示

### 🔄 可优化功能
- [ ] 资源返还机制
- [ ] 更多建筑类型
- [ ] 建筑特效和动画
- [ ] 领地装饰系统
- [ ] 建筑组合效果
- [ ] 领地契约道具系统

### 🚀 未来扩展
- [ ] 资源产出建筑
- [ ] 建筑升级树
- [ ] 领地排行榜
- [ ] 社交功能
- [ ] PVP领地对战

## 📱 使用方法

1. **访问领地**: 点击底部导航栏的"领地"按钮
2. **建造建筑**: 点击第一块绿色地块，选择建筑类型
3. **管理建筑**: 点击已建造的建筑查看信息和操作
4. **升级建筑**: 在建筑信息弹窗中点击"升级"按钮
5. **拆迁建筑**: 在建筑信息弹窗中点击"拆迁"按钮

## 🔧 技术细节

- **前端框架**: 原生JavaScript + HTML5 + CSS3
- **模块化**: ES6模块系统
- **响应式**: CSS Grid + Flexbox布局
- **动画**: CSS3过渡和变换
- **数据流**: 单向数据流，状态管理

---

*最后更新: 2024年10月15日*
