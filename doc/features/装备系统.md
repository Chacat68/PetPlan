# 装备系统文档

## 概述

装备系统为玩家提供了提升角色战力的另一途径。玩家可以获取装备、装配装备、并通过装备获得属性加成。

## 功能概述

### 核心功能

1. **装备获取** - 通过战斗、任务、购买等方式获取装备
2. **装备穿戴** - 将装备装配到装备槽位，获得属性加成
3. **装备卸下** - 卸下不需要的装备
4. **装备强化** - 通过升级提升装备属性
5. **装备合成** - 将多个低级装备合成为高级装备

## 装备类型

### 按装备部位分类

| 部位 | 说明 | 效果 |
|------|------|------|
| 头部 | 头盔、冠冕等 | 增加防御/生命 |
| 身体 | 盔甲、衣服等 | 增加防御/生命 |
| 手部 | 手套、护腕等 | 增加攻击/防御 |
| 足部 | 靴子、脚甲等 | 增加防御/移动速度 |
| 主武器 | 剑、锤等 | 增加攻击力 |
| 副武器 | 盾牌等 | 增加防御力 |
| 饰品 | 项链、戒指等 | 增加各种属性 |

### 按品质分类

| 品质 | 等级 | 说明 |
|------|------|------|
| 普通 | 1 | 基础装备，属性加成少 |
| 稀有 | 2 | 较好的装备，有基本加成 |
| 传奇 | 3 | 高级装备，加成显著 |
| 神圣 | 4 | 顶级装备，稀有且强大 |

## 系统架构

### 核心模块

**EquipmentSystem** (`equipment-system.js`)
- 管理装备库存
- 处理装备穿戴和卸下
- 计算装备属性加成
- 处理装备强化和合成

**EquipmentUI** (`equipment-ui.js`)
- 显示装备界面
- 显示装备详情
- 处理用户交互
- 展示装备属性对比

## 数据结构

### 装备对象

```javascript
{
    id: 'sword_001',              // 装备唯一ID
    name: '铁剑',                 // 装备名称
    type: 'weapon',               // 装备类型：weapon/armor/accessory
    part: 'main_hand',            // 装备部位
    quality: 1,                   // 品质：1-4
    level: 1,                     // 装备等级
    basePower: 100,               // 基础战力
    baseAttack: 10,               // 基础攻击
    bonusAttributes: {            // 加成属性
        attack: 5,
        defense: 2,
        hp: 0
    },
    required: {                   // 装备要求
        playerLevel: 1,
        gold: 500
    },
    experience: 0,                // 装备经验（用于升级）
    maxExperience: 100
}
```

### 玩家装备槽位

```javascript
{
    head: null,                   // 头部装备
    body: null,                   // 身体装备
    hands: null,                  // 手部装备
    feet: null,                   // 足部装备
    mainHand: null,               // 主武器
    offHand: null,                // 副武器
    accessories: [                // 饰品（可多个）
        // ...
    ]
}
```

## 使用方法

### 在游戏中集成

```javascript
import { getEquipmentSystemInstance } from './modules/equipment-system.js';

// 获取装备系统实例
const equipmentSystem = getEquipmentSystemInstance();

// 装备一个装备
equipmentSystem.equipItem(equipmentId, 'main_hand');

// 卸下装备
equipmentSystem.unequipItem('main_hand');

// 获取总属性加成
const totalBonus = equipmentSystem.getTotalAttributeBonus();
```

### 打开装备界面

玩家通过点击游戏界面的装备按钮打开装备管理界面，可以：
- 查看当前穿戴的装备
- 查看背包中的装备
- 穿戴和卸下装备
- 查看装备详情和属性对比

## 装备强化

### 升级装备

装备可以通过消耗金币和经验值来升级：

```javascript
equipmentSystem.upgradeEquipment(equipmentId, amount);
```

强化后装备的属性加成会增加。

## 装备合成

### 合成规则

- 2 个相同稀有度的装备 → 1 个更高稀有度的装备
- 合成需要消耗金币和红宝石
- 合成后原装备消失

```javascript
equipmentSystem.combineEquipment(equipment1Id, equipment2Id);
```

## 属性加成计算

### 总属性加成

玩家的总属性加成 = 所有穿戴装备的加成之和

```javascript
totalAttack = baseAttack + sum(equipment.bonusAttack)
totalDefense = baseDefense + sum(equipment.bonusDefense)
totalHp = baseHp + sum(equipment.bonusHp)
```

## 性能优化

- 装备数据使用索引优化查询
- 属性加成缓存机制，仅在装备改变时重算
- UI 使用虚拟列表优化大量装备显示

## 存档集成

装备系统数据完全集成到存档系统：
- 所有装备库存自动保存
- 装备穿戴状态保存
- 装备强化等级保存
- 玩家属性加成自动应用

---

**版本**：v1.0.0  
**最后更新**：2025年12月14日
