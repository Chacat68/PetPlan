# å® ç‰©ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

å® ç‰©ç³»ç»Ÿæ˜¯ Pet Plan æ¸¸æˆçš„æ ¸å¿ƒç©æ³•ä¹‹ä¸€ï¼Œä¸ºç©å®¶æä¾›æ”¶é›†ã€åŸ¹å…»ã€ç¼–é˜Ÿå’Œä½¿ç”¨å® ç‰©è¿›è¡Œæˆ˜æ–—çš„å®Œæ•´ä½“éªŒã€‚

## 2. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PetSystem                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   å® ç‰©æ”¶é›†    â”‚  â”‚   å® ç‰©å…»æˆ    â”‚  â”‚   å® ç‰©ç¼–é˜Ÿ    â”‚   â”‚
â”‚  â”‚  - å›¾é‰´      â”‚  â”‚  - å‡çº§       â”‚  â”‚  - å‰æ’3æ§½   â”‚   â”‚
â”‚  â”‚  - è§£é”      â”‚  â”‚  - å–‚é£Ÿ       â”‚  â”‚  - åæ’3æ§½   â”‚   â”‚
â”‚  â”‚  - ç¨€æœ‰åº¦    â”‚  â”‚  - è®­ç»ƒ       â”‚  â”‚  - è£…å¤‡/å¸ä¸‹  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   å® ç‰©æˆ˜æ–—    â”‚  â”‚   æŠ€èƒ½ç³»ç»Ÿ    â”‚  â”‚   çŠ¶æ€ç®¡ç†    â”‚   â”‚
â”‚  â”‚  - æ™®é€šæ”»å‡»   â”‚  â”‚  - æŠ€èƒ½é‡Šæ”¾   â”‚  â”‚  - é¥±è…¹åº¦    â”‚   â”‚
â”‚  â”‚  - å­å¼¹ç³»ç»Ÿ   â”‚  â”‚  - å†·å´æ—¶é—´   â”‚  â”‚  - ç²¾åŠ›å€¼    â”‚   â”‚
â”‚  â”‚  - ä¼¤å®³è®¡ç®—   â”‚  â”‚  - æŠ€èƒ½ç‰¹æ•ˆ   â”‚  â”‚  - å¥½æ„Ÿåº¦    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. å® ç‰©å›¾é‰´

### 3.1 å® ç‰©åˆ—è¡¨

| ID | åç§° | ç¨€æœ‰åº¦ | å±æ€§ | è§£é”ç­‰çº§ | æˆæœ¬ |
|----|------|--------|------|----------|------|
| 1 | ç«ç„°çŠ¬ğŸ”¥ğŸ• | æ™®é€š | ç« | 1 | 500ğŸ’° |
| 2 | å†°éœœçŒ«â„ï¸ğŸ± | æ™®é€š | å†° | 1 | 500ğŸ’° |
| 3 | é›·ç”µé¸Ÿâš¡ğŸ¦… | ä¼˜ç§€ | é›· | 5 | 2000ğŸ’°+50ğŸ”´ |
| 4 | å¤§åœ°ç†ŠğŸŒğŸ» | ä¼˜ç§€ | åœŸ | 8 | 3000ğŸ’°+100ğŸ”´ |
| 5 | é£æš´é¾™ğŸŒªï¸ğŸ‰ | ç¨€æœ‰ | é£ | 15 | 10000ğŸ’°+300ğŸ”´ |
| 6 | å…‰æ˜ç‹¬è§’å…½âœ¨ğŸ¦„ | å²è¯— | å…‰ | 20 | 20000ğŸ’°+500ğŸ”´ |
| 7 | æš—å½±ç‹¼ğŸŒ‘ğŸº | å²è¯— | æš— | 25 | 25000ğŸ’°+600ğŸ”´ |
| 8 | å‡¤å‡°ğŸ”¥ğŸ¦… | ä¼ è¯´ | å‡¤å‡° | 30 | 50000ğŸ’°+1000ğŸ”´ |

### 3.2 ç¨€æœ‰åº¦é…ç½®

| ç¨€æœ‰åº¦ | é¢œè‰² | æ˜Ÿçº§ | è¯´æ˜ |
|--------|------|------|------|
| common | #9e9e9e | â­ | æ™®é€š |
| uncommon | #4caf50 | â­â­ | ä¼˜ç§€ |
| rare | #2196f3 | â­â­â­ | ç¨€æœ‰ |
| epic | #9c27b0 | â­â­â­â­ | å²è¯— |
| legendary | #ff9800 | â­â­â­â­â­ | ä¼ è¯´ |

### 3.3 å® ç‰©åŸºç¡€å±æ€§

```javascript
{
    baseAttack: 15,      // åŸºç¡€æ”»å‡»åŠ›
    baseHp: 80,          // åŸºç¡€ç”Ÿå‘½å€¼
    baseDefense: 5,      // åŸºç¡€é˜²å¾¡åŠ›
    attackSpeed: 1.0     // æ”»å‡»é€Ÿåº¦ï¼ˆæ¬¡/ç§’ï¼‰
}
```

### 3.4 å±æ€§æˆé•¿

æ¯å‡ä¸€çº§ï¼š
- æ”»å‡»åŠ› +5
- æœ€å¤§ç”Ÿå‘½å€¼ +20
- é˜²å¾¡åŠ› +2

## 4. æŠ€èƒ½ç³»ç»Ÿ

### 4.1 æŠ€èƒ½åˆ—è¡¨

| æŠ€èƒ½ | å® ç‰© | CD | æ•ˆæœ |
|------|------|-----|------|
| ç«çƒæœ¯ | ç«ç„°çŠ¬ | 5ç§’ | å‘å°„ç«çƒé€ æˆ50ç‚¹èŒƒå›´ä¼¤å®³ |
| å†°éœœæ–°æ˜Ÿ | å†°éœœçŒ« | 6ç§’ | å†»ç»“å‘¨å›´æ•Œäººï¼Œé€ æˆ40ç‚¹ä¼¤å®³å¹¶å‡é€Ÿ50% |
| è¿é”é—ªç”µ | é›·ç”µé¸Ÿ | 7ç§’ | é‡Šæ”¾é—ªç”µæ”»å‡»3ä¸ªç›®æ ‡ï¼Œæ¯ä¸ª60ç‚¹ä¼¤å®³ |
| åœ°éœ‡ | å¤§åœ°ç†Š | 8ç§’ | åˆ¶é€ åœ°éœ‡ï¼Œ80ç‚¹ä¼¤å®³å¹¶çœ©æ™•1ç§’ |
| é¾™å·é£ | é£æš´é¾™ | 10ç§’ | å¬å”¤é¾™å·é£ï¼ŒæŒç»­3ç§’é€ æˆ120ç‚¹ä¼¤å®³ |
| åœ£å…‰ç¥ç¦ | å…‰æ˜ç‹¬è§’å…½ | 12ç§’ | æ²»ç–—50ç‚¹ç”Ÿå‘½å¹¶å¢åŠ 20%æ”»å‡»åŠ›æŒç»­5ç§’ |
| æš—å½±çªè¢­ | æš—å½±ç‹¼ | 6ç§’ | ä»æš—å½±ä¸­çªè¢­ï¼Œ150ç‚¹ä¼¤å®³ï¼Œ50%æš´å‡»ç‡ |
| æµ´ç«é‡ç”Ÿ | å‡¤å‡° | 30ç§’ | æ­»äº¡æ—¶å¤æ´»å¹¶é€ æˆ200ç‚¹çˆ†ç‚¸ä¼¤å®³ |

### 4.2 æŠ€èƒ½ç±»å‹

```javascript
// ä¼¤å®³æŠ€èƒ½
{ type: 'damage', damage: 50, targets: 1 }

// æ§åˆ¶æŠ€èƒ½
{ type: 'control', slow: 0.5, stun: 1000 }

// å¢ç›ŠæŠ€èƒ½
{ type: 'buff', heal: 50, buff: 1.2, duration: 5000 }
```

## 5. å® ç‰©ç¼–é˜Ÿ

### 5.1 æ§½ä½é…ç½®

```javascript
slots: {
    front: [null, null, null],  // å‰æ’3ä¸ªæ§½ä½
    back: [null, null, null]    // åæ’3ä¸ªæ§½ä½
}
```

### 5.2 ä½ç½®è®¡ç®—

```javascript
getPetPosition(position, slotIndex) {
    const mapSize = this.gameCore.getMapSize();
    
    // å‰æ’åœ¨å³ä¾§(x=100)ï¼Œåæ’åœ¨å·¦ä¾§(x=60)
    const baseX = position === 'front' ? 100 : 60;
    const baseY = mapSize.height - 100;
    
    // å‚ç›´é—´è·40åƒç´ 
    const spacing = 40;
    const y = baseY - (slotIndex * spacing);
    
    return { x: baseX, y: y };
}
```

### 5.3 æˆ˜æ–—å®šä½å»ºè®®

| ä½ç½® | æ¨èç±»å‹ | ä»£è¡¨å® ç‰© |
|------|----------|----------|
| å‰æ’ | å¦å…‹/è‚‰ç›¾ | å¤§åœ°ç†Šã€é£æš´é¾™ |
| åæ’ | è¾“å‡º/è¾…åŠ© | é›·ç”µé¸Ÿã€æš—å½±ç‹¼ã€å…‰æ˜ç‹¬è§’å…½ |

## 6. å…»æˆç³»ç»Ÿ

### 6.1 çŠ¶æ€å±æ€§

| å±æ€§ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| friendship | 0-100 | å¥½æ„Ÿåº¦ï¼Œå½±å“æˆ˜æ–—å±æ€§åŠ æˆ(0-20%) |
| hunger | 0-100 | é¥±è…¹åº¦ï¼Œä½äº30ä¼šé™ä½æˆ˜æ–—æ•ˆç‡(70%) |
| energy | 0-100 | ç²¾åŠ›å€¼ï¼Œè®­ç»ƒéœ€è¦æ¶ˆè€— |

### 6.2 çŠ¶æ€è¡°å‡

- é¥±è…¹åº¦ï¼šæ¯10åˆ†é’Ÿå‡å°‘10ç‚¹
- ç²¾åŠ›å€¼ï¼šæ¯å°æ—¶æ¢å¤20ç‚¹

### 6.3 å–‚é£Ÿç³»ç»Ÿ

```javascript
feedPet(petInstanceId) {
    // æˆæœ¬ï¼š50é‡‘å¸ Ã— å® ç‰©ç­‰çº§
    // æ•ˆæœï¼šé¥±è…¹åº¦+30, ç²¾åŠ›+20, å¥½æ„Ÿåº¦+2
    cost = 50 * pet.level;
    hunger = Math.min(100, hunger + 30);
    energy = Math.min(100, energy + 20);
    friendship = Math.min(100, friendship + 2);
}
```

### 6.4 è®­ç»ƒç³»ç»Ÿ

```javascript
trainPet(petInstanceId) {
    // æˆæœ¬ï¼š100é‡‘å¸ Ã— å® ç‰©ç­‰çº§ï¼Œæ¶ˆè€—20ç²¾åŠ›
    // æ•ˆæœï¼šè·å¾—(20 + ç­‰çº§Ã—5)ç»éªŒï¼Œå¥½æ„Ÿåº¦+1
    cost = 100 * pet.level;
    expGain = 20 + pet.level * 5;
}
```

## 7. æˆ˜æ–—ç³»ç»Ÿ

### 7.1 æ™®é€šæ”»å‡»

```javascript
petNormalAttack(pet, position, slotIndex) {
    // 1. å¯»æ‰¾æœ€è¿‘ç›®æ ‡
    const target = findNearestMonster(pet, position, slotIndex);
    
    // 2. è®¡ç®—æ”»å‡»é—´éš”
    const attackInterval = 1000 / pet.attackSpeed;
    
    // 3. å‘å°„å­å¼¹
    const bullet = {
        damage: pet.attack,
        speed: 300,
        type: pet.type,
        size: 6
    };
}
```

### 7.2 å­å¼¹ç³»ç»Ÿ

```javascript
// å­å¼¹é¢œè‰²æ˜ å°„
const colors = {
    fire: '#ff5722',
    ice: '#03a9f4',
    thunder: '#ffeb3b',
    earth: '#8d6e63',
    wind: '#9ccc65',
    light: '#fff176',
    dark: '#9e9e9e',
    phoenix: '#ff6f00'
};
```

### 7.3 ä¼¤å®³è®¡ç®—

```javascript
// åŸºç¡€ä¼¤å®³
let damage = pet.attack;

// å¥½æ„Ÿåº¦åŠ æˆ (æœ€é«˜20%)
const friendshipBonus = pet.friendship / 500;

// é¥±è…¹åº¦æƒ©ç½š (ä½äº30å‡å°‘30%)
const hungerPenalty = pet.hunger < 30 ? 0.7 : 1.0;

// æœ€ç»ˆä¼¤å®³
finalDamage = damage * (1 + friendshipBonus) * hungerPenalty;
```

## 8. æ•°æ®ç»“æ„

### 8.1 å® ç‰©æ¨¡æ¿

```javascript
{
    id: 1,
    name: 'ç«ç„°çŠ¬',
    rarity: 'common',
    type: 'fire',
    baseAttack: 15,
    baseHp: 80,
    baseDefense: 5,
    attackSpeed: 1.0,
    skill: {
        id: 'fireball',
        name: 'ç«çƒæœ¯',
        cooldown: 5000,
        damage: 50,
        description: 'å‘å°„ç«çƒé€ æˆèŒƒå›´ä¼¤å®³'
    },
    image: 'ğŸ”¥ğŸ•',
    description: 'å¿ è¯šçš„ç«ç³»ä¼™ä¼´',
    unlockLevel: 1,
    unlockCost: { coins: 500, gems: 0 }
}
```

### 8.2 å® ç‰©å®ä¾‹

```javascript
{
    instanceId: 1234567890,      // å”¯ä¸€å®ä¾‹ID
    templateId: 1,               // æ¨¡æ¿ID
    level: 1,                    // å½“å‰ç­‰çº§
    exp: 0,                      // å½“å‰ç»éªŒ
    expToNext: 100,              // å‡çº§æ‰€éœ€ç»éªŒ
    attack: 15,                  // å½“å‰æ”»å‡»åŠ›
    hp: 80,                      // å½“å‰ç”Ÿå‘½å€¼
    maxHp: 80,                   // æœ€å¤§ç”Ÿå‘½å€¼
    defense: 5,                  // å½“å‰é˜²å¾¡åŠ›
    currentHp: 80,               // æˆ˜æ–—ä¸­ç”Ÿå‘½å€¼
    friendship: 0,               // å¥½æ„Ÿåº¦
    hunger: 100,                 // é¥±è…¹åº¦
    energy: 100,                 // ç²¾åŠ›å€¼
    lastFeedTime: Date.now(),    // ä¸Šæ¬¡å–‚é£Ÿæ—¶é—´
    lastTrainTime: Date.now(),   // ä¸Šæ¬¡è®­ç»ƒæ—¶é—´
    position: null,              // è£…å¤‡ä½ç½®
    isInBattle: false,           // æ˜¯å¦åœ¨æˆ˜æ–—ä¸­
    buffs: [],                   // å¢ç›Šæ•ˆæœ
    debuffs: []                  // å‡ç›Šæ•ˆæœ
}
```

### 8.3 å­˜æ¡£æ•°æ®

```javascript
{
    ownedPets: [{
        instanceId, templateId, level, exp, expToNext,
        attack, hp, maxHp, defense,
        friendship, hunger, energy,
        lastFeedTime, lastTrainTime, position
    }],
    slots: {
        front: [instanceId | null, ...],
        back: [instanceId | null, ...]
    }
}
```

## 9. API æ¥å£

### 9.1 å® ç‰©ç®¡ç†

| æ–¹æ³• | å‚æ•° | è¿”å› | è¯´æ˜ |
|------|------|------|------|
| unlockPet | petId | {success, message, pet} | è§£é”å® ç‰© |
| equipPet | petInstanceId, position, slotIndex | {success, message} | è£…å¤‡å® ç‰© |
| unequipPet | petInstanceId | {success, message} | å¸ä¸‹å® ç‰© |
| upgradePet | petInstanceId | {success, message} | å‡çº§å® ç‰© |

### 9.2 å…»æˆæ“ä½œ

| æ–¹æ³• | å‚æ•° | è¿”å› | è¯´æ˜ |
|------|------|------|------|
| feedPet | petInstanceId | {success, message} | å–‚é£Ÿå® ç‰© |
| trainPet | petInstanceId | {success, message} | è®­ç»ƒå® ç‰© |

### 9.3 æŸ¥è¯¢æ¥å£

| æ–¹æ³• | å‚æ•° | è¿”å› | è¯´æ˜ |
|------|------|------|------|
| getEquippedPets | - | Pet[] | è·å–å·²è£…å¤‡å® ç‰© |
| getTotalPowerBonus | - | {attack, defense} | è·å–æˆ˜åŠ›åŠ æˆ |
| getSaveData | - | Object | è·å–å­˜æ¡£æ•°æ® |
| loadSaveData | data | void | åŠ è½½å­˜æ¡£æ•°æ® |

## 10. ä¸å…¶ä»–ç³»ç»Ÿé›†æˆ

### 10.1 ä¸æˆ˜æ–—ç³»ç»Ÿ

```javascript
// CombatSystem è°ƒç”¨ PetSystem
if (this.petSystem) {
    this.updatePetCombat(deltaTime);
    this.checkPetBulletCollisions();
    this.applyPetSkillEffects();
}

// è·å–æ€ªç‰©ä¾›å® ç‰©æ”»å‡»
const monsters = this.combatSystem.getMonsters();
```

### 10.2 ä¸èµ„æºç³»ç»Ÿ

```javascript
// è§£é”å® ç‰©æ¶ˆè€—èµ„æº
this.resourceSystem.spendCoins(cost.coins);
this.resourceSystem.spendRubies(cost.gems);

// å–‚é£Ÿ/è®­ç»ƒæ¶ˆè€—
this.resourceSystem.spendCoins(50 * pet.level);
```

### 10.3 ä¸å­˜æ¡£ç³»ç»Ÿ

```javascript
// åœ¨ SaveSystem ä¸­è°ƒç”¨
pets: this.petSystem ? this.petSystem.getSaveData() : null

// åŠ è½½æ—¶æ¢å¤
if (gameState.pets && this.petSystem) {
    this.petSystem.loadSaveData(gameState.pets);
}
```

## 11. æœªæ¥è§„åˆ’

### 11.1 å® ç‰©è¿›åŒ–
- è¾¾åˆ°ç‰¹å®šç­‰çº§å¯è¿›åŒ–
- è¿›åŒ–åå¤–è§‚å’ŒæŠ€èƒ½æ”¹å˜
- å±æ€§å¤§å¹…æå‡

### 11.2 å® ç‰©èåˆ
- ä¸¤åªç›¸åŒå® ç‰©å¯èåˆ
- æå‡æ˜Ÿçº§
- è·å¾—é¢å¤–æŠ€èƒ½

### 11.3 å® ç‰©è£…å¤‡
- ä¸ºå® ç‰©è£…å¤‡é“å…·
- æä¾›é¢å¤–å±æ€§åŠ æˆ

### 11.4 å® ç‰©ç¾ç»Š
- ç‰¹å®šå® ç‰©ç»„åˆäº§ç”Ÿç¾ç»Šæ•ˆæœ
- æä¾›é¢å¤–åŠ æˆ
