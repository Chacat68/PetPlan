# 游戏系统设计

本文档汇总了 PetPlan 所有游戏系统的核心设计。

---

## 目录

1. [游戏核心系统](#游戏核心系统)
2. [玩家系统](#玩家系统)
3. [战斗系统](#战斗系统)
4. [宠物系统](#宠物系统)
5. [领地系统](#领地系统)
6. [资源系统](#资源系统)
7. [存档系统](#存档系统)
8. [成就系统](#成就系统)
9. [装备系统](#装备系统)
10. [离线系统](#离线系统)

---

## 游戏核心系统

### 概述

GameCore 负责游戏主循环、场景渲染和帧率控制。

### 核心功能

- **游戏循环**: requestAnimationFrame 60 FPS
- **场景渲染**: 天空、山脉、地面、云朵
- **系统协调**: 调用各子系统的 update/render

### 关键配置

```javascript
{
    canvas: { width: 400, height: 435 },
    targetFps: 60,
    autoSaveInterval: 30000  // 30秒
}
```

---

## 玩家系统

### 概述

管理玩家角色数据、属性升级和战力计算。

### 战斗属性

| 属性     | 初始值 | 说明           |
| -------- | ------ | -------------- |
| 攻击力   | 20     | 基础伤害       |
| 生命值   | 100    | 最大生命       |
| 防御力   | 0      | 减伤比例       |
| 生命恢复 | 1      | 每秒回血       |
| 暴击伤害 | 150%   | 暴击倍数       |
| 攻击速度 | 1.0    | 射击频率       |
| 暴击率   | 5%     | 暴击概率       |
| 多重射击 | 1      | 同时射出子弹数 |

### 三维属性

- **力量**: 增加攻击力和生命值
- **敏捷**: 增加攻速和暴击
- **智力**: 增加技能伤害和恢复

### 战力计算

```javascript
totalPower =
  attack * 10 +
  maxHp * 0.5 +
  defense * 5 +
  hpRegen * 2 +
  critDamage * 0.1 +
  attackSpeed * 50 +
  crit * 3 +
  multiShot * 100;
```

---

## 战斗系统

### 概述

处理怪物生成、子弹系统、碰撞检测和伤害计算。

### 怪物生成

- 生成间隔: 2000ms
- 生成位置: 画布右侧
- 移动方向: 向左

### 子弹系统

- 速度: 300 像素/秒
- 寻找最近怪物自动攻击
- 支持多重射击

### 伤害计算

```javascript
let damage = attack;
const isCrit = Math.random() * 100 < critRate;
if (isCrit) {
  damage *= critDamage / 100;
}
finalDamage = Math.max(1, damage - monsterDefense);
```

### 奖励系统

- 击杀怪物获得金币
- 金币量与怪物等级相关

---

## 宠物系统

### 概述

宠物收集、养成、编队和战斗系统。

### 宠物列表

| ID  | 名称          | 稀有度 | 属性 | 解锁等级 | 成本           |
| --- | ------------- | ------ | ---- | -------- | -------------- |
| 1   | 火焰犬 🔥     | 普通   | 火   | 1        | 500💰          |
| 2   | 冰霜猫 ❄️     | 普通   | 冰   | 1        | 500💰          |
| 3   | 雷电鸟 ⚡     | 优秀   | 雷   | 5        | 2000💰+50🔴    |
| 4   | 大地熊 🌍     | 优秀   | 土   | 8        | 3000💰+100🔴   |
| 5   | 风暴龙 🌪️     | 稀有   | 风   | 15       | 10000💰+300🔴  |
| 6   | 光明独角兽 ✨ | 史诗   | 光   | 20       | 20000💰+500🔴  |
| 7   | 暗影狼 🌑     | 史诗   | 暗   | 25       | 25000💰+600🔴  |
| 8   | 凤凰 🔥       | 传说   | 凤凰 | 30       | 50000💰+1000🔴 |

### 稀有度配置

| 稀有度    | 颜色    | 星级       |
| --------- | ------- | ---------- |
| common    | #9e9e9e | ⭐         |
| uncommon  | #4caf50 | ⭐⭐       |
| rare      | #2196f3 | ⭐⭐⭐     |
| epic      | #9c27b0 | ⭐⭐⭐⭐   |
| legendary | #ff9800 | ⭐⭐⭐⭐⭐ |

### 编队系统

- 前排: 3 个槽位（坦克/肉盾）
- 后排: 3 个槽位（输出/辅助）

### 养成系统

| 属性   | 范围  | 说明                      |
| ------ | ----- | ------------------------- |
| 好感度 | 0-100 | 影响战斗属性加成(0-20%)   |
| 饱腹度 | 0-100 | 低于 30 降低战斗效率(70%) |
| 精力值 | 0-100 | 训练需要消耗              |

**喂食**: 50 金币 × 等级 → 饱腹度+30, 精力+20, 好感度+2  
**训练**: 100 金币 × 等级 + 20 精力 → 经验+(20+等级 ×5), 好感度+1

### 技能系统

| 技能     | 宠物       | CD  | 效果                    |
| -------- | ---------- | --- | ----------------------- |
| 火球术   | 火焰犬     | 5s  | 50 点范围伤害           |
| 冰霜新星 | 冰霜猫     | 6s  | 40 点伤害+50%减速       |
| 连锁闪电 | 雷电鸟     | 7s  | 3 目标各 60 点伤害      |
| 地震     | 大地熊     | 8s  | 80 点伤害+1 秒眩晕      |
| 龙卷风   | 风暴龙     | 10s | 3 秒持续 120 点伤害     |
| 圣光祝福 | 光明独角兽 | 12s | 治疗 50+20%攻击力 5 秒  |
| 暗影突袭 | 暗影狼     | 6s  | 150 点伤害+50%暴击率    |
| 浴火重生 | 凤凰       | 30s | 死亡复活+200 点爆炸伤害 |

---

## 领地系统

### 概述

领地建设、建筑升级和资源产出系统。

### 地块配置

- 初始地块: 6 个 (2×3)
- 最大地块: 12 个
- 解锁方式: 玩家等级达标

### 建筑类型

| 建筑      | 功能         | 初期产出   |
| --------- | ------------ | ---------- |
| 🏰 主基地 | 控制建筑上限 | -          |
| 🏋️ 训练场 | 攻击力加成   | +5 攻击    |
| 🏛️ 神庙   | 防御力加成   | +5 防御    |
| ⚔️ 兵营   | 攻防综合加成 | +3 攻防    |
| 🔨 工坊   | 产出金币     | 50 金币/次 |
| 💎 水晶矿 | 产出水晶     | 10 水晶/次 |
| 📚 图书馆 | 经验加成     | -          |

### 扩张成本

| 次数 | 金币   | 水晶  | 主基地要求 |
| ---- | ------ | ----- | ---------- |
| 1    | 10,000 | 500   | 1 级       |
| 2    | 25,000 | 1,500 | 1 级       |
| 3    | 50,000 | 3,000 | 2 级       |

---

## 资源系统

### 概述

管理游戏中的三种货币。

### 货币类型

| 货币   | 图标 | 用途                         |
| ------ | ---- | ---------------------------- |
| 金币   | 💰   | 升级属性、购买宠物、建造建筑 |
| 红宝石 | 🔴   | 购买稀有宠物、加速建造       |
| 水晶   | 💎   | 领地扩张、高级建筑           |

### 数字格式化

使用后缀表示大数字: `1.2K`, `3.5M`, `2.1B`

---

## 存档系统

### 概述

游戏数据的保存、加载和备份。

### 存档功能

- 5 个存档槽位
- 自动保存 (每 30 秒)
- 快捷键保存/加载 (F5/F9)
- JSON 导入/导出

### 存档内容

```javascript
{
    version: "1.0.1",
    timestamp: Date.now(),
    level: playerLevel,
    player: { ... },
    resources: { ... },
    pets: { ... },
    territory: { ... },
    combat: { ... }
}
```

---

## 成就系统

### 概述

任务追踪和奖励领取系统。

### 每日任务

- 每日刷新
- 完成后领取奖励
- 奖励金币/红宝石

### 长期成就

- 累计击杀怪物
- 累计获得金币
- 收集宠物数量
- 升级属性次数

---

## 装备系统

### 概述

装备获取、穿戴和属性加成。

### 装备类型

- 武器: 增加攻击力
- 护甲: 增加防御力
- 饰品: 特殊效果

### 品质等级

普通 → 优秀 → 稀有 → 史诗 → 传说

---

## 离线系统

### 概述

离线收益计算和领取。

### 离线收益

- 基于领地建筑的资源产出
- 离线时间上限: 24 小时
- 收益比例: 在线的 50%

### 计算公式

```javascript
offlineGain = hourlyProduction * offlineHours * 0.5;
```
