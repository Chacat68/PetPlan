<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´è¯Šæ–­</title>
    <link rel="stylesheet" href="css/style.css?v=31">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/character-management.css">
    <link rel="stylesheet" href="css/save-system.css">
    <link rel="stylesheet" href="css/pet-system.css">
    <style>
        .debug-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 11px;
            z-index: 100000;
            max-height: 200px;
            overflow-y: auto;
            border-top: 2px solid #0f0;
        }
        .debug-panel .error { color: #f00; }
        .debug-panel .success { color: #0f0; }
        .debug-panel .info { color: #ff0; }
        .debug-panel .warn { color: #f90; }
    </style>
</head>
<body>
    <div class="debug-panel" id="debugPanel">
        <div><strong>è¯Šæ–­é¢æ¿åˆå§‹åŒ–...</strong></div>
    </div>

    <div class="game-container initial-fade">
        <div class="game-area">
            <canvas id="gameCanvas" width="400" height="435"></canvas>
            <div class="game-ui-overlay">
                <div class="game-top-status">
                    <div class="game-status-left">
                        <div class="currency-display">
                            <div class="currency-item">
                                <span class="currency-icon">ğŸ’°</span>
                                <span id="coins">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const debugPanel = document.getElementById('debugPanel');
        const logs = [];
        
        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const entry = `<div class="${type}">[${time}] ${msg}</div>`;
            logs.push(entry);
            if (logs.length > 20) logs.shift();
            debugPanel.innerHTML = logs.join('');
            console.log(`[${type.toUpperCase()}] ${msg}`);
        }

        // æ•è·æ‰€æœ‰é”™è¯¯
        window.addEventListener('error', (e) => {
            log(`å…¨å±€é”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            log(`Promiseæ‹’ç»: ${e.reason}`, 'error');
        });

        log('å¼€å§‹åˆå§‹åŒ–...', 'info');
        
        // æ£€æŸ¥DOMå…ƒç´ 
        const canvas = document.getElementById('gameCanvas');
        const container = document.querySelector('.game-container');
        
        log(`Canvas: ${canvas ? 'âœ“' : 'âœ—'}`, canvas ? 'success' : 'error');
        log(`Container: ${container ? 'âœ“' : 'âœ—'}`, container ? 'success' : 'error');
        log(`Container ç±»: ${container ? container.className : 'N/A'}`, 'info');
        
        if (canvas) {
            const rect = canvas.getBoundingClientRect();
            log(`Canvasä½ç½®: x=${rect.x.toFixed(0)} y=${rect.y.toFixed(0)} w=${rect.width.toFixed(0)} h=${rect.height.toFixed(0)}`, 'info');
            log(`Canvaså¯è§æ€§: ${getComputedStyle(canvas).visibility}`, 'info');
            log(`Canvasé€æ˜åº¦: ${getComputedStyle(canvas).opacity}`, 'info');
        }
        
        if (container) {
            log(`Containeré€æ˜åº¦: ${getComputedStyle(container).opacity}`, 'info');
            log(`Container display: ${getComputedStyle(container).display}`, 'info');
        }

        // å°è¯•å¯¼å…¥ main.js
        log('å¼€å§‹åŠ è½½ main.js...', 'info');
        
        try {
            const startTime = performance.now();
            await import('./js/main.js');
            const loadTime = (performance.now() - startTime).toFixed(2);
            log(`main.js åŠ è½½æˆåŠŸ (${loadTime}ms)`, 'success');
            
            // ç­‰å¾…ä¸€ä¼šæ£€æŸ¥æ¸¸æˆçŠ¶æ€
            setTimeout(() => {
                log('æ£€æŸ¥æ¸¸æˆçŠ¶æ€...', 'info');
                log(`Window.game: ${window.game ? 'âœ“' : 'âœ—'}`, window.game ? 'success' : 'error');
                
                if (window.game) {
                    const state = window.game.getGameState();
                    log(`æ¸¸æˆå·²åˆå§‹åŒ–: ${state.isInitialized ? 'âœ“' : 'âœ—'}`, state.isInitialized ? 'success' : 'error');
                    log(`æ¸¸æˆè¿è¡Œä¸­: ${state.isRunning ? 'âœ“' : 'âœ—'}`, state.isRunning ? 'success' : 'warn');
                }
                
                if (container) {
                    const hasInitialFade = container.classList.contains('initial-fade');
                    const hasFadeIn = container.classList.contains('fade-in');
                    log(`initial-fade ç±»: ${hasInitialFade ? 'ä»å­˜åœ¨âŒ' : 'å·²ç§»é™¤âœ“'}`, hasInitialFade ? 'error' : 'success');
                    log(`fade-in ç±»: ${hasFadeIn ? 'å·²æ·»åŠ âœ“' : 'æœªæ·»åŠ âŒ'}`, hasFadeIn ? 'success' : 'error');
                    log(`Container æœ€ç»ˆé€æ˜åº¦: ${getComputedStyle(container).opacity}`, 'info');
                }
                
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const imageData = ctx.getImageData(100, 100, 10, 10);
                    const hasContent = Array.from(imageData.data).some(v => v !== 0);
                    log(`Canvas æœ‰æ¸²æŸ“å†…å®¹: ${hasContent ? 'âœ“' : 'âœ—'}`, hasContent ? 'success' : 'error');
                }
            }, 2000);
            
        } catch (error) {
            log(`main.js åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            log(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
        }
    </script>
</body>
</html>
